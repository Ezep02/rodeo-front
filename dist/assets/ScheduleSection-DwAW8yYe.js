import{c as O,A as W,r as u,V as _,j as e,F as z,Z as $,B as N,H as D,I as S,J as A,K as C,M as k,O as E,E as J,g as y,$ as Q}from"./index-AL-VPenz.js";import{C as X,c as ee}from"./card-DXiLM1pq.js";import{M as se,g as P,f as B,a as te,b as ae}from"./getAppointmentStatus-DxMMHfZL.js";import{a as ne}from"./index-DOOy_dnx.js";import{a as le,b as ie}from"./index-D7hatq2D.js";import{b as ce,c as re}from"./index-DABRC3vZ.js";import{A as oe,b as de,c as xe,d as me,e as he,f as ue,g as pe,T as F,P as ge}from"./alert-dialog-DWojgdsi.js";import{S as fe}from"./SuccessAlert-CesVCbMF.js";import{G as je,a as ve}from"./index-Bz9dQuiV.js";import{u as we,C as Ne}from"./useSlots-Bc6p4izx.js";import{a as be}from"./index-CNfnnRa4.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=O("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=O("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=O("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=O("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),V="http://localhost:9090/api/v1/appointments",R=async(s,n)=>(await W.get(`${V}/page/${s}/${n}`)).data,Ce=async(s,n)=>(await W.post(`${V}/cancel/${s}`,n)).data,ke=()=>{const[s,n]=u.useState(new Map),l=t=>t.toISOString().slice(0,10),r=async(t,i)=>{try{const o=t.toISOString().slice(0,10),c=i.toISOString().slice(0,10),g=await R(o,c);g.appointments.length>0&&n(b=>{const f=new Map(b);return g.appointments.forEach(j=>{const d=l(new Date(j.slot.date));f.has(d)||f.set(d,[]);const v=f.get(d);v.some(w=>w.id===j.id)||v.push(j)}),f})}catch(o){console.log(o),console.log("Error moving offset")}};function x(t,i){const{id:o,slot:c}=i.data,g=l(new Date(c.date));n(b=>{const f=new Map(b);f.has(g)||f.set(g,[]);const j=f.get(g),d=j.find(v=>v.id===o);switch(t){case"appointment_created":d||j.push(i.data);break;case"appointment_cancelled":d&&(console.log("appointment_cancelled"),d.status="cancelled");break;case"appointment_updated":d&&(d.status="updated",d.slot=c);break}return f})}return u.useEffect(()=>{const t=new EventSource("http://localhost:9090/api/v1/stream");return t.addEventListener("message",i=>{try{const o=JSON.parse(i.data);x(o.type,o)}catch(o){console.error("Error parsing SSE message",o)}}),t.onerror=i=>{console.error("SSE connection error",i),t.close()},()=>{t.close()}},[]),u.useEffect(()=>{(async()=>{const i=new Date,o=i.getDay(),c=new Date(i);c.setDate(i.getDate()-o),c.setHours(0,0,0,0);const g=new Date(c);g.setDate(c.getDate()+6),g.setHours(23,59,59,999);const b=c.toISOString().slice(0,10),f=g.toISOString().slice(0,10);try{const j=await R(b,f),d=new Map;j.appointments.forEach(v=>{const p=l(new Date(v.slot.date));d.has(p)||d.set(p,[]);const w=d.get(p);w.some(L=>L.id===v.id)||w.push(v)}),n(d)}catch(j){console.log(j)}})()},[]),{hashMap:s,MoveAppointmentOffset:r}};function Oe(s){return _({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M5 12H3v9h9v-2H5zm7-7h7v7h2V3h-9z"},child:[]}]})(s)}function Ae(s){return _({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 4H6c-1.103 0-2 .897-2 2v5h2V8l6.4 4.8a1.001 1.001 0 0 0 1.2 0L20 8v9h-8v2h8c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm-7 6.75L6.666 6h12.668L13 10.75z"},child:[]},{tag:"path",attr:{d:"M2 12h7v2H2zm2 3h6v2H4zm3 3h4v2H7z"},child:[]}]})(s)}function Ee(s){return _({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M22,3 L2,11 L20.5,19 L22,3 Z M10,20.5 L13,16 M15.5,9.5 L9,14 L9.85884537,20.0119176 C9.93680292,20.5576204 10.0751625,20.5490248 10.1651297,20.009222 L11,15 L15.5,9.5 Z"},child:[]}]})(s)}const Me=({Client:s})=>{const[n,l]=u.useState(!1),r=()=>{l(t=>!t)},x=async()=>{try{r()}catch(t){console.warn("Algo no fue bien enviando el recordatorio",t)}};return e.jsxs(z,{open:n,onOpenChange:r,children:[e.jsx($,{asChild:!0,children:e.jsxs(N,{variant:"default",size:"sm",onClick:()=>r,children:[e.jsx(ce,{}),"Enviar Recordatorio"]})}),e.jsxs(D,{className:`\r
                    w-full h-full p-6 bg-zinc-50 z-50 flex flex-col\r
                    overflow-y-auto shadow-2xl rounded-3xl\r
                    max-w-sm max-h-[50vh]\r
                    md:max-w-xl md:max-h-[40vh] md:min-h-[40vh]\r
                `,children:[e.jsx(S,{className:"mb-2 pt-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:r,children:e.jsx(A,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-zinc-700",children:"Correo"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(Ae,{size:24})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg font-semibold text-zinc-700 text-start",children:"Enviar Recordatorio"}),e.jsx(k,{className:"text-start text-zinc-600",children:"Enviale un recordatorio al cliente."})]})]})]})}),e.jsxs("main",{className:"flex flex-grow",children:["TODO: implementar envio",s]}),e.jsx(E,{children:e.jsxs(N,{size:"sm",onClick:x,children:[e.jsx(Ee,{}),"Enviar"]})})]})]})},Le=({appt:s})=>{const[n,l]=u.useState(!1),r=()=>l(p=>!p),[x,t]=u.useState(!1),[i,o]=u.useState(!1),[c,g]=u.useState(""),[b,f]=u.useState(!1),[j,d]=u.useState(""),v=async()=>{try{await Ce(s.id,{expire_at:new Date(new Date().setFullYear(new Date().getFullYear()+1)),recharge:100})&&(r(),g("Cita cancelada exitosamente"),o(!0))}catch{f(!0),d("Algo no fue bien cancelando la cita")}};return e.jsxs(z,{open:n,onOpenChange:l,children:[e.jsx(N,{size:"sm",variant:"ghost",className:"text-zinc-800",onClick:()=>{s.payment_percentage<100?l(!0):t(!0)},children:"Cancelar Cita"}),e.jsx(oe,{open:x,onOpenChange:t,children:e.jsxs(de,{children:[e.jsxs(xe,{children:[e.jsx(me,{children:"No puedes cancelar esta cita"}),e.jsx(he,{children:"Esta cita ya fue pagada en su totalidad (100%), Por lo que no puede ser cancelada."})]}),e.jsx(ue,{children:e.jsx(pe,{onClick:()=>t(!1),children:"Cerrar"})})]})}),e.jsx(fe,{message:c,show:i,onClose:()=>t(!1)}),e.jsx(J,{message:j,show:b,onClose:()=>t(!1)}),e.jsxs(D,{className:`w-full h-full p-6 bg-zinc-50 z-50 flex flex-col\r
               overflow-y-auto shadow-2xl rounded-3xl\r
               max-w-sm max-h-[50vh]\r
               md:max-w-xl md:max-h-[40vh] md:min-h-[40vh]`,children:[e.jsxs(S,{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:r,children:e.jsx(A,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-xl font-bold text-zinc-800",children:"Cancelar cita"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(se,{size:24})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg font-semibold text-zinc-700 text-start",children:"¿Estás seguro de que deseas cancelar?"}),e.jsx(k,{className:"text-zinc-600 mt-1 text-start",children:"Revisa bien esta acción. Una vez cancelada, no se podrá revertir."})]})]})]}),e.jsx("main",{className:"flex flex-col gap-3 text-sm text-zinc-700 pb-5 flex-grow",children:e.jsxs("p",{className:"p-5 bg-gray-100 rounded-lg shadow-sm font-semibold",children:["Al cancelar la cita, el cliente obtendrá un ",e.jsx("span",{className:"font-semibold text-green-700",children:"descuento del 100%"})," en su próxima compra."]})}),e.jsxs(E,{children:[e.jsx(N,{size:"sm",variant:"ghost",className:"text-zinc-800",onClick:r,children:"No, Volver"}),e.jsx(N,{size:"sm",onClick:v,children:"Si, Cancelar"})]})]})]})},Te=(s,n)=>{const x=`${(typeof s=="string"?new Date(s):s).toISOString().split("T")[0]}T${n}:00`;return new Date(x)>=new Date},Ie=({order:s})=>{if(!s)return null;const n=s.products.reduce((c,g)=>c+g.price,0),l=n*s.payment_percentage/100,r=n-l,[x,t]=u.useState(!1),i=()=>t(c=>!c),o=P(s.status);return e.jsxs(z,{open:x,onOpenChange:t,children:[e.jsx($,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-1 text-sm text-violet-200 hover:text-violet-100 transition",onClick:i,children:[e.jsx(je,{size:16}),"Ver"]})}),e.jsxs(D,{className:`\r
                w-full h-full max-w-full max-h-full p-6 bg-zinc-50 z-50 flex flex-col\r
                overflow-y-auto shadow-2xl md:rounded-3xl\r
                2xl:max-h-[90vh] 2xl:min-h-[80vh] 2xl:max-w-5xl\r
                xl:max-h-[90vh] xl:min-h-[80vh] xl:max-w-4xl\r
                lg:max-h-[90vh] lg:min-h-[85vh] lg:max-w-3xl\r
                md:max-h-[95vh] md:min-h-[80vh] md:max-w-2xl\r
                scroll-abrir-editar-tarjeta\r
            `,children:[e.jsx(S,{className:"mb-2 pt-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:i,children:e.jsx(A,{size:18,className:"text-zinc-700"})}),e.jsxs("h1",{className:"text-lg font-semibold text-zinc-700",children:["Detalles de la cita #",s.id]}),e.jsx("span",{className:y("text-xs px-2 py-0.5 rounded-full font-medium",o.className),children:o.label})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(ne,{size:24})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg font-semibold text-zinc-700 text-start",children:"Información de la Cita"}),e.jsx(k,{className:"text-start text-zinc-600",children:"Revisa todos los detalles de esta cita, incluyendo cliente, servicios y pagos."})]})]})]})}),e.jsxs("main",{className:"flex flex-col gap-6 flex-grow",children:[e.jsxs("div",{className:"flex flex-col bg-zinc-800 px-4 py-3 rounded-2xl",children:[e.jsx("label",{className:"text-sm text-zinc-300",children:"Cliente"}),e.jsxs("h3",{className:"text-zinc-50",children:[s.client_name," ",s.client_surname]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-1/2",children:[e.jsx("span",{className:"font-medium text-sm text-zinc-600",children:"Datos generales"}),e.jsxs("div",{className:"bg-zinc-800 px-4 py-3 rounded-2xl text-white",children:[e.jsx("label",{className:"text-sm text-zinc-300",children:"Barbero"}),e.jsx("p",{children:s.slot.barber.name})]}),e.jsxs("div",{className:"bg-zinc-800 px-4 py-3 rounded-2xl text-white flex flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-zinc-300",children:"Total abonado"}),e.jsxs("p",{className:"text-sm",children:["$",l.toFixed(2)," / $",n.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mt-2 text-sm text-zinc-300",children:"Debe"}),e.jsxs("p",{className:`${s.payment_percentage<100?"text-red-500 font-semibold":"text-green-500 font-semibold"}
                                        `,children:["$",r.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-zinc-800 px-4 py-3 rounded-2xl text-white",children:[e.jsx("label",{className:"text-sm text-zinc-300",children:"Fecha de creación"}),e.jsx("p",{children:new Date(s.created_at).toLocaleDateString("es-AR",{day:"numeric",month:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-1/2",children:[e.jsx("span",{className:"font-medium text-sm text-zinc-600",children:"Fecha y Hora"}),e.jsxs("div",{className:"bg-zinc-800 px-4 py-3 rounded-2xl text-white flex justify-between items-center",children:[e.jsx("p",{children:new Date(s.slot.date).toLocaleDateString("es-AR",{day:"numeric",month:"numeric",year:"numeric"})}),e.jsx(le,{})]}),e.jsxs("div",{className:"bg-zinc-800 px-4 py-3 rounded-2xl text-white flex justify-between items-center",children:[e.jsx("p",{children:B(s.slot.time)}),e.jsx(te,{})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"font-medium text-sm text-zinc-600",children:"Servicios seleccionados"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-56 overflow-auto pr-1",children:s.products.map(c=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 border border-zinc-200 px-4 py-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 bg-rose-500 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-zinc-800",children:c.name}),e.jsxs("span",{className:"text-xs text-zinc-500",children:["#",c.id]})]})]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",c.price]})]},c.id))})]})]}),e.jsx(E,{children:s.status!=="cancelled"&&Te(new Date(s.slot.date),s.slot.time)&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{appt:s}),e.jsx(Me,{Client:s.client_name})]})})]})]})},G=({appointment:s})=>{const n=s.products.reduce((t,i)=>t+i.price,0),l=n*s.payment_percentage/100,r=ae(s.payment_percentage),x=P(s.status);return e.jsx(e.Fragment,{children:e.jsx(X,{className:"w-full rounded-3xl shadow-sm hover:shadow-md transition-shadow duration-300 bg-zinc-900",children:e.jsxs(ee,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-zinc-400"}),e.jsx("span",{className:"text-sm text-zinc-200",children:B(s.slot.time)})]}),e.jsx(Ie,{order:s})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-semibold text-zinc-50",children:[s.client_name," ",s.client_surname]}),e.jsxs("p",{className:"text-sm text-neutral-300",children:["$",l.toFixed(0)," / $",n.toFixed(0)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:y("text-xs px-2 py-0.5 rounded-full font-medium",x.className),children:x.label}),e.jsx("span",{className:y("text-xs px-2 py-0.5 rounded-full font-medium",r.className),children:r.label})]})]})})})},_e=s=>{switch(s){case"NEW":return{text:"Nuevo",color:"bg-blue-100 text-blue-700"};case"UPDATE":return{text:"Editado",color:"bg-yellow-100 text-yellow-700"};case"DELETE":return{text:"Para eliminar",color:"bg-red-100 text-red-600"};default:return{text:"Sin cambios",color:"bg-gray-100 text-gray-600"}}},He=({slot:s,UpdateCurrentSlot:n,index:l,RemoveSlot:r,selectedDate:x,CancelDelete:t})=>{var o;const i=_e(s.status);return e.jsxs("div",{className:y("rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 p-4 bg-white border border-zinc-200 space-y-3",s.is_booked&&"opacity-90"),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"font-semibold text-zinc-700 text-sm",children:["Horario #",l+1]}),s.is_booked?e.jsx(N,{size:"icon",variant:"ghost",disabled:!0,className:"text-zinc-400 cursor-not-allowed",children:e.jsx(F,{className:"h-4 w-4"})}):s.status==="DELETE"?e.jsx(N,{size:"icon",variant:"ghost",className:"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100",onClick:()=>t(x,l),children:e.jsx(Se,{className:"h-4 w-4"})}):e.jsx(N,{size:"icon",variant:"ghost",className:"text-rose-500 hover:text-rose-600",onClick:()=>r(x,l),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-zinc-500 block mb-1",children:"Hora"}),e.jsx("input",{type:"time",value:s.time,onChange:c=>n(c.target.value,l),disabled:s.is_booked,className:y("w-full px-3 py-2 rounded-md border text-sm font-medium","focus:outline-none focus:ring-2 focus:ring-zinc-300",s.is_booked?"bg-zinc-100 text-zinc-400 cursor-not-allowed border-zinc-200":"bg-white text-zinc-700 border-zinc-300")})]}),e.jsxs("div",{className:"text-sm text-zinc-600",children:[e.jsx("span",{className:"font-medium",children:"Barbero:"})," ",((o=s.barber)==null?void 0:o.name)??"—"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("span",{className:y("px-2 py-0.5 rounded-full font-medium",s.is_booked?"bg-zinc-200 text-zinc-600":"bg-emerald-100 text-emerald-700"),children:s.is_booked?"No disponible":"Disponible"}),e.jsx("span",{className:y("px-2 py-0.5 rounded-full font-medium",i.color),children:i.text}),s.is_booked&&e.jsxs("span",{className:"flex items-center gap-1 text-zinc-500",children:[e.jsx(ze,{className:"w-3 h-3"}),"Reservado"]})]})]})},Fe=({AppointmentDate:s,AddSlot:n,RemoveSlot:l,UpdateCurrentSlot:r,slotDate:x,filteredSlots:t,setSlotDate:i,SaveSlots:o,slotIsLoading:c,CancelDelete:g,onClose:b,isOpen:f})=>{u.useEffect(()=>{i(s)},[s,i]);const j=u.useMemo(()=>{const p=new Date;return p.setHours(0,0,0,0),p},[]),d=u.useMemo(()=>{const p=new Date(x??new Date);return p.setHours(0,0,0,0),p},[x]),v=d.getTime()===j.getTime();return e.jsx(z,{open:f,onOpenChange:b,children:e.jsxs(D,{className:`w-full h-full max-w-full max-h-full p-6 bg-zinc-50 z-50 flex flex-col\r
                overflow-y-auto scroll-abrir-editar-tarjeta shadow-2xl md:rounded-3xl\r
                2xl:max-h-[90vh] 2xl:min-h-[80vh] 2xl:max-w-5xl\r
                xl:max-h-[90vh] xl:min-h-[80vh] xl:max-w-4xl\r
                lg:max-h-[90vh] lg:min-h-[85vh] lg:max-w-3xl\r
                md:max-h-[95vh] md:min-h-[80vh] md:max-w-2xl`,children:[e.jsxs(S,{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:b,children:e.jsx(ie,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-zinc-700",children:"Turnos"})]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(be,{size:24})}),e.jsxs("div",{children:[e.jsxs(C,{className:"text-lg font-semibold text-zinc-700 text-start",children:["Crear horarios para el"," ",d.toLocaleDateString("es-AR",{day:"numeric",month:"long",year:"numeric"})]}),e.jsx(k,{className:"text-start text-zinc-600",children:"Añadí y gestioná todos los turnos disponibles para este día."})]})]})]}),e.jsx("main",{className:"flex flex-col gap-4 flex-1",children:c?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin h-6 w-6 border-4 border-rose-500 border-t-transparent rounded-full"})}):t&&t.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:t.map((p,w)=>e.jsx(He,{slot:p,index:w,UpdateCurrentSlot:r,RemoveSlot:l,selectedDate:d,CancelDelete:g},w))}):e.jsx("p",{className:"text-center text-zinc-500 py-8",children:"No hay horarios registrados para esta fecha."})}),e.jsxs(E,{children:[e.jsxs(N,{variant:"ghost",className:"text-zinc-900",onClick:()=>n(d),disabled:v,children:[e.jsx(ge,{className:"h-4 w-4"}),"Agregar Horario"]}),e.jsx(N,{onClick:o,children:"Guardar Horarios"})]})]})})},Re=({appts:s})=>{const[n,l]=u.useState(!1),r=()=>l(t=>!t),x=s.length-2;return x<=0?null:e.jsxs(e.Fragment,{children:[e.jsxs(N,{size:"sm",variant:"ghost",className:"rounded-xl",onClick:r,children:["Ver más (+",x,")"]}),e.jsx(z,{open:n,onOpenChange:r,children:e.jsxs(D,{className:`w-full h-full max-w-full max-h-full p-6 bg-zinc-50 z-50 flex flex-col\r
          overflow-y-auto shadow-2xl md:rounded-3xl\r
          2xl:max-h-[80vh] 2xl:min-h-[80vh] 2xl:max-w-xl\r
          xl:max-h-[90vh] xl:min-h-[80vh] xl:max-w-4xl\r
          lg:max-h-[90vh] lg:min-h-[85vh] lg:max-w-3xl\r
          md:max-h-[95vh] md:min-h-[80vh] md:max-w-2xl`,children:[e.jsx(S,{className:"mb-2 pt-2",children:e.jsxs("div",{className:"flex items-start flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:r,children:e.jsx(A,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-zinc-700",children:"Citas Pendientes"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(re,{size:24})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg text-start font-semibold text-zinc-700",children:"Lista de citas pendientes"}),e.jsx(k,{className:"text-start",children:"Dale un vistazo a la lista completa de citas activas."})]})]})]})}),e.jsx("main",{className:"flex flex-col gap-1 overflow-hidden overflow-y-auto scroll-abrir-editar-tarjeta",children:s.slice(2).map(t=>e.jsx(G,{appointment:t},t.id))})]})})]})},Je=()=>{const{MoveAppointmentOffset:s,hashMap:n}=ke(),{AddSlot:l,RemoveSlot:r,UpdateCurrentSlot:x,slotDate:t,filteredSlots:i,setSlotDate:o,SaveSlots:c,slotIsLoading:g,CancelDelete:b,MoveSlotOffset:f,GetSlotQuantByDate:j}=we(),d=a=>{const h=a.getDay(),m=a.getDate()-h;return new Date(a.getFullYear(),a.getMonth(),m)},v=a=>{const h=d(a);h.setHours(0,0,0,0);const m=new Date(h);return m.setDate(h.getDate()+6),m.setHours(23,59,59,999),{startOfWeek:h,endOfWeek:m}},p=u.useMemo(()=>{const a=new Date;return a.setHours(0,0,0,0),a},[]),[w,M]=u.useState(d(p)),L=u.useMemo(()=>Array.from({length:7}).map((a,h)=>{const m=new Date(w);return m.setDate(m.getDate()+h),m}),[w]),U=u.useMemo(()=>{const a={};return n.forEach((h,m)=>{a[m]=h}),a},[n]),K=()=>{const a=new Date(w);a.setDate(a.getDate()-7);const{endOfWeek:h,startOfWeek:m}=v(a);h<p||(M(a),s(m,h),f(m,h))},q=()=>{const a=new Date(w);a.setDate(a.getDate()+7);const{startOfWeek:h,endOfWeek:m}=v(a);M(a),s(h,m),f(h,m)},[T,I]=u.useState(null),Y=a=>{o(a),I(a)};return e.jsx("div",{className:"flex flex-col min-h-[60vh] w-full bg-white border border-slate-200 shadow-md rounded-2xl overflow-hidden flex-grow",children:e.jsxs("div",{className:"p-4 flex flex-col h-full flex-grow",children:[e.jsxs("div",{className:"mb-6 flex gap-2 justify-between flex-wrap ",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-lg shadow-sm",children:e.jsx(ve,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold",children:"Calendario Semanal"}),e.jsx("p",{className:"text-sm",children:"Turnos por día de la semana"})]})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:K,children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Semana del ",w.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:q,children:e.jsx(Q,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 flex-grow overflow-y-auto scroll-abrir-editar-tarjeta",children:L.map(a=>{const h=a.toISOString().split("T")[0],m=U[h]||[],Z=(T==null?void 0:T.toISOString().split("T")[0])===h;return e.jsxs("div",{className:"border rounded-lg p-5 shadow-sm flex flex-col flex-grow",children:[e.jsx("div",{className:"flex flex-col gap-1 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-800",children:a.toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short"})}),e.jsxs("button",{onClick:()=>Y(a),className:"flex items-center gap-2 text-sm text-zinc-600 hover:text-zinc-800 hover:bg-zinc-100 px-3 py-2 rounded-full transition","aria-label":"Expandir día",children:[e.jsx(Oe,{size:18}),e.jsxs("span",{className:"whitespace-nowrap",children:[j(a)," ",j(a)===1?"turno activo":"turnos activos"]})]})]})}),e.jsx("div",{className:"space-y-2 pt-4",children:m.length>0?e.jsxs(e.Fragment,{children:[m.slice(0,2).map(H=>e.jsx(G,{appointment:H},H.id)),m.length>2&&e.jsx(Re,{appts:m})]}):e.jsx("p",{className:"text-gray-400 text-sm italic",children:"Aun no se registraron turnos"})}),e.jsx(Fe,{AppointmentDate:a,AddSlot:l,CancelDelete:b,RemoveSlot:r,SaveSlots:()=>{c(),I(null)},UpdateCurrentSlot:x,filteredSlots:i,setSlotDate:o,slotDate:t,slotIsLoading:g,onClose:()=>I(null),isOpen:Z})]},h)})})]})})};export{Je as default};
