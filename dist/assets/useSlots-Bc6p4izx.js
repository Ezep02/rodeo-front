import{c as X,A as I,r as l,al as Z}from"./index-AL-VPenz.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=X("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),O="http://localhost:9090/api/v1/slots",x=async c=>(await I.post(`${O}/`,c)).data,tt=async c=>(await I.delete(`${O}/`,{data:c})).data,et=async c=>(await I.put(`${O}/`,c)).data,H=async(c,E)=>(await I.get(`${O}/page/${c}/${E}`)).data,ct=()=>{const{user:c}=l.useContext(Z),[E,M]=l.useState(0),U=async(s,e)=>{try{const t=s.toISOString().slice(0,10),o=e.toISOString().slice(0,10),a=await H(t,o);a.slots.length>0&&S(n=>{const r=new Map(n);return a.slots.forEach(d=>{const m=i(new Date(d.date)),p={id:d.id,date:new Date(d.date),time:d.time,status:"NOT CHANGE",barber:d.barber,is_booked:d.is_booked};r.has(m)||r.set(m,[]);const f=r.get(m);f.some(T=>T.id===p.id)||f.push(p)}),r})}catch{console.log("Error moving offset")}M(t=>t+31)},[W,_]=l.useState(!1),g=()=>{_(s=>!s)},[G,N]=l.useState([]),[D,F]=l.useState(new Date),[u,S]=l.useState(new Map),[b,C]=l.useState([]),[P,$]=l.useState(!1),[B,k]=l.useState(0),A=()=>{k(s=>s+1)},L=()=>{k(s=>s-1)},w=()=>{$(s=>!s)},h={NEW:[],UPDATED:[]},i=s=>s.toISOString().split("T")[0];l.useEffect(()=>{let s=!1;(async()=>{if(s)return;s=!0;const t=new Date,o=t.getDay(),a=new Date(t);a.setDate(t.getDate()-o),a.setHours(0,0,0,0);const n=new Date(a);n.setDate(a.getDate()+6),n.setHours(23,59,59,999);const r=a.toISOString().slice(0,10),d=n.toISOString().slice(0,10);try{const m=await H(r,d),p=new Map;m.slots.forEach(f=>{const y=i(new Date(f.date)),T={id:f.id,date:new Date(f.date),time:f.time,status:"NOT CHANGE",is_booked:f.is_booked,barber:f.barber};p.has(y)||p.set(y,[]);const v=p.get(y);v.some(V=>V.id===T.id)||v.push(T)}),S(p)}catch{console.warn("Algo no fue bien recuperando los slots")}})()},[]);const R=s=>{const e=i(s),t=new Map(u);let o={id:(c==null?void 0:c.ID)??0,name:(c==null?void 0:c.name)??"",surname:(c==null?void 0:c.surname)??""};const a={date:s,time:"",status:"NEW",is_booked:!1,barber:o};t.has(e)||t.set(e,[]);const n=t.get(e);n==null||n.push(a),A(),S(t)},Q=(s,e)=>{const t=i(s),o=new Map(u);o.has(t)||o.set(t,[]);const a=o.get(t);if(a&&a[e]){let n=a[e].status;if((n==="NOT CHANGE"||n==="UPDATE")&&a[e].id!==void 0){a[e].status="DELETE";const r=[...b,a[e]];C(r),A()}n==="NEW"&&a.splice(e,1),S(o),L()}},K=(s,e)=>{if(!D)return console.warn("Fecha inválida en update useEffect");const t=i(D),o=new Map(u),a=o.get(t);a&&a[e]&&(a[e].status==="NOT CHANGE"&&(a[e].time=s,a[e].status="UPDATE",A()),a[e].time=s,S(o))},Y=(s,e)=>{if(!s)return console.warn("Fecha inválida en update useEffect");const t=i(s),o=new Map(u),a=o.get(t);a&&a[e]&&(a[e].status==="DELETE"&&(a[e].status="NOT CHANGE",L()),S(o))};l.useEffect(()=>{if(!D)return console.warn("Fecha inválida en useEffect");const s=i(D),e=new Map(u);if(e.has(s)){const t=e.get(s);N(t??[]);return}N([])},[D,u]);async function j(s){w();try{const e=await x(s);if(e!=null&&e.slot){const t=new Map(u);e.slot.forEach(o=>{const a=i(new Date(o.date)),n=t.get(a);if(!n)return;const r=n.findIndex(d=>i(d.date)===i(new Date(o.date))&&d.time===o.time);r!==-1&&(n[r]={...n[r],id:o.id,status:"NOT CHANGE",is_booked:o.is_booked??!1})}),S(t),h.NEW=[]}}catch(e){console.warn("Error creando slots:",e)}w(),g()}async function q(s){w();const e=s.filter(t=>typeof t.id=="number").map(t=>({...t,id:t.id}));try{await et(e)}catch(t){console.warn(t)}w(),g()}async function z(s){w();try{await tt(s),C([])}catch(e){console.warn("DELETE BY IDS",e)}w(),g()}function J(){u.forEach((s,e)=>{s.forEach((t,o)=>{switch(t.status){case"NEW":h.NEW.push({date:t.date,time:t.time});break;case"UPDATE":t.id&&h.UPDATED.push({id:t.id,date:t.date,time:t.time});break}})}),h.NEW.length>0&&j(h.NEW),h.UPDATED.length>0&&q(h.UPDATED),b.length>0&&z(b)}return{filteredSlots:G,AddSlot:R,RemoveSlot:Q,UpdateCurrentSlot:K,SaveSlots:J,slotIsLoading:P,slotDialogOpen:W,HandleSlotDialogOpen:g,slotOffset:E,MoveSlotOffset:U,hashMap:u,setHashMap:S,CancelDelete:Y,totalChanges:B,slotDate:D,setSlotDate:F,GetSlotQuantByDate:s=>{const e=i(s),t=u.get(e);return t?t.length:0}}};export{nt as C,ct as u};
