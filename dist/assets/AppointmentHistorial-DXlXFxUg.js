import{c as J,A as I,r as m,D as T,j as e,l as G,b as $,B as k,h as K,m as O,Z as X,$ as Y,a0 as ee,a1 as se,a2 as te,a3 as L,O as re,k as ne}from"./index-DhWYa8W4.js";import{u as ae}from"./useUser-CJqXQwqe.js";import{C as ce}from"./card-Dsn8Ms4I.js";import{C as ie,a as oe,b as le}from"./collapsible-CnSEVpH5.js";import{D as z,a as W,b as F,c as H,d as M,e as P,u as de,C as me}from"./useSlots-ChQCJa-Q.js";import{u as ue}from"./index.esm-CKUi-DfO.js";import{C as Q}from"./calendar-liZZeWiC.js";import"./x-Drps6sCP.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Z="http://localhost:9090/api/v1/appointments",xe=async s=>(await I.get(`${Z}/user/${s}`)).data.appointments,B=async(s,c)=>(await I.delete(`${Z}/${s}`,{data:{recharge:c}})).data,he=()=>{const{user:s}=ae(),{setCustomerAppointment:c,customerAppointment:l}=m.useContext(T);return m.useEffect(()=>{(async()=>{if((s==null?void 0:s.ID)!==void 0)try{const i=await xe(s.ID);i.length>0&&c(i)}catch(i){console.log(i)}})()},[]),{customerAppointment:l}},pe="http://localhost:9090/api/v1/reviews",ge=async s=>(await I.post(`${pe}/`,s)).data,fe=({appointment:s})=>{const[c,l]=m.useState(!1),[a,i]=m.useState([]),x=()=>{l(t=>!t)},{register:v,handleSubmit:y,watch:f,setValue:r}=ue({defaultValues:{comment:"",rating:0}}),d=f("comment"),j=f("rating"),h=t=>{const o=a.includes(t),n=o?a.filter(p=>p!==t):[...a,t];if(i(n),o){const p=new RegExp(`\\s*${t}`,"g"),b=d.replace(p,"").trim();r("comment",b)}else{const p=d&&!d.trim().endsWith(".")&&!d.endsWith(" ")?" ":"";r("comment",`${d}${p}${t}`)}},{setCustomerAppointment:N}=m.useContext(T),[g,C,S]=m.useActionState(async(t,o)=>{const{comment:n,rating:p}=o;try{const b={appointment_id:s.id,comment:n,rating:p},u=await ge(b);u&&N(D=>D.map(w=>w.id===s.id?{...w,review:{id:0,comment:u.review.comment,rating:u.review.rating,appointmentID:u.review.appointment_id}}:w)),x()}catch(b){console.log(b)}},null),_=t=>{m.startTransition(()=>{C(t)})},R=["Excelente atención","Muy profesional","Ambiente agradable","Buen precio","Lo recomiendo"];return e.jsxs(z,{open:c,onOpenChange:x,children:[e.jsx(W,{asChild:!0,children:e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>r("rating",t),className:"transition-transform duration-200 hover:scale-110",children:e.jsx(G,{className:$("h-5 w-5 transition-colors",t<=j?"text-amber-400 fill-amber-400":"text-slate-200")})},t))})}),e.jsx(F,{className:"sm:max-w-[450px] sm:h-auto h-full p-0 overflow-hidden sm:rounded-xl bg-black transition-shadow border-zinc-600",children:S?e.jsx(H,{children:e.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-4 ",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-rose-500 border-t-transparent rounded-full animate-spin"}),e.jsxs(M,{className:"text-center text-lg font-semibold text-slate-800 flex items-center gap-2",children:["Enviando Reseña",e.jsx(U,{className:"w-5 h-5 text-rose-500"})]}),e.jsx(P,{children:"Esto puede tardar unos segundos..."})]})}):e.jsxs("form",{onSubmit:y(_),className:"p-6 space-y-6 bg-gray-900/50 border-gray-800 sm:rounded-md shadow-md",children:[e.jsx("div",{className:"flex flex-col items-start gap-3",children:e.jsxs(H,{children:[e.jsxs(M,{className:"text-xl text-start font-bold text-rose-500",children:["¿Qué te pareció el servicio ",e.jsx("span",{className:"text-rose-400"}),"?"]}),e.jsx(P,{className:"text-sm text-start text-zinc-400",children:"Tu opinión es importante para que podamos seguir mejorando nuestros servicios"})]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"comment",className:"text-sm font-medium text-zinc-300",children:"Descripción"}),e.jsx("textarea",{id:"comment",rows:6,placeholder:"Comparte tu experiencia...",className:"w-full p-3 text-sm text-zinc-100 bg-gray-800 border border-gray-700 rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-rose-500 placeholder-zinc-500",...v("comment")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Etiquetas rápidas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(t=>e.jsx(k,{type:"button",variant:a.includes(t)?"default":"outline",className:$("h-8 text-xs",a.includes(t)?"bg-rose-500 hover:bg-rose-600 text-white":"border-gray-600 text-zinc-300 hover:bg-gray-800 bg-transparent hover:border-rose-500 hover:text-rose-500 hover:bg-transparent"),onClick:()=>h(t),children:t},t))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(k,{type:"button",variant:"ghost",onClick:()=>l(!1),className:"flex-1 border border-gray-700 text-zinc-300 hover:text-zinc-400 bg-transparent hover:bg-transparent",children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:j===0||S,className:"flex-1 bg-rose-500 hover:bg-rose-600 text-white gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4"}),"Enviar Reseña"]})})]})]})})]})};function je(s){return K({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M899.4 638.2h-27.198c-2.2-.6-4.2-1.6-6.4-2-57.2-8.8-102.4-56.4-106.2-112.199-4.401-62.4 31.199-115.2 89.199-132.4 7.6-2.2 15.6-3.8 23.399-5.8h27.2c1.8.6 3.4 1.6 5.4 1.8 52.8 8.6 93 46.6 104.4 98.6.8 4 2 8 3 12v27.2c-.6 1.8-1.6 3.6-1.8 5.4-8.4 52-45.4 91.599-96.801 103.6-5 1.2-9.6 2.6-14.2 3.8zM130.603 385.8l27.202.001c2.2.6 4.2 1.6 6.4 1.8 57.6 9 102.6 56.8 106.2 113.2 4 62.2-32 114.8-90.2 131.8-7.401 2.2-15 3.8-22.401 5.6h-27.2c-1.8-.6-3.4-1.6-5.2-2-52-9.6-86-39.8-102.2-90.2-2.2-6.6-3.4-13.6-5.2-20.4v-27.2c.6-1.8 1.6-3.6 1.8-5.4 8.6-52.2 45.4-91.6 96.8-103.6 4.8-1.201 9.4-2.401 13.999-3.601zm370.801.001h27.2c2.2.6 4.2 1.6 6.4 2 57.4 9 103.6 58.6 106 114.6 2.8 63-35.2 116.4-93.8 131.4-6.2 1.6-12.4 3-18.6 4.4h-27.2c-2.2-.6-4.2-1.6-6.4-2-57.4-8.8-103.601-58.6-106.2-114.6-3-63 35.2-116.4 93.8-131.4 6.4-1.6 12.6-3 18.8-4.4z"},child:[]}]})(s)}const be="http://localhost:9090/api/v1/appointments",ve="http://localhost:9090/api/v1/mercado_pago",we=async(s,c,l)=>{let a={new_slot_id:l,old_slot_id:c};return(await I.put(`${be}/${s}`,a)).data},ye=async s=>(await I.post(`${ve}/surcharge`,s)).data,Ne=s=>{const{setCustomerAppointment:c}=m.useContext(T),[l,a]=m.useState(!1),[i,x]=m.useState(void 0),{date:v,filteredSlots:y,setDate:f,MoveSlotOffset:r,setHashMap:d}=de(),j=(o,n)=>{const p=new Date,b=new Date(o);b.setHours(0,0,0,0);const[u,D]=n.split(":").map(Number),w=new Date(b);w.setHours(u,D,0,0);const A=(w.getTime()-p.getTime())/(1e3*60*60);return A<=24&&A>0},[h,N,g]=m.useActionState(async(o,n)=>{try{await we(n.appointment.id,n.appointment.slot.id,n.slot_to_replace.id)&&(d(b=>{const u=new Map(b);for(const[D,w]of u.entries()){const E=w.map(A=>A.id===n.appointment.slot.id?{...A,is_booked:!1}:A.id===n.slot_to_replace.id?{...A,is_booked:!0}:A);u.set(D,E)}return u}),c(b=>{const u=[...b],D=u.findIndex(w=>w.id===n.appointment.id);return D!==-1&&(u[D]={...u[D],slot:{...n.slot_to_replace,is_booked:!0}}),u}),x(void 0),a(!1))}catch(p){console.warn("Algo no fue bien",p)}},null),C=()=>{a(o=>!o)},S=()=>{if(!i)return;const o=j(s.slot.date,s.slot.time);m.startTransition(()=>{o?R({appointment:s,slot_to_replace:i}):N({appointment:s,slot_to_replace:i})})},[_,R,t]=m.useActionState(async(o,n)=>{let p=n.appointment.payment_percentage,u=n.appointment.products.reduce((E,A)=>E+A.price,0)*(p/100),D=p<100?u*(50/100):u*(25/100),w={appointment_id:n.appointment.id,new_slot_id:n.slot_to_replace.id,old_slot_id:n.appointment.slot.id,surcharge_price:D};try{let E=await ye(w);window.location.href=E.init_point}catch(E){console.warn("Error recargo reprogramación",E)}},null);return{isOpen:l,toggleDialog:C,selectedTime:i,setSelectedTime:x,date:v,setDate:f,MoveSlotOffset:r,filteredSlots:y,handleReschedule:S,isWithin24Hours:j(s.slot.date,s.slot.time),isReschedulingPending:g||t,reschedulingErr:h,surchargeErr:_}},Ce=({appointment:s})=>{const{isOpen:c,toggleDialog:l,selectedTime:a,setSelectedTime:i,date:x,setDate:v,MoveSlotOffset:y,filteredSlots:f,handleReschedule:r,isWithin24Hours:d,isReschedulingPending:j}=Ne(s);return e.jsxs(z,{open:c,onOpenChange:l,children:[e.jsx(W,{asChild:!0,children:e.jsx("button",{children:"Reprogramar"})}),e.jsx(F,{children:j?e.jsxs("div",{className:"w-full flex justify-center items-center flex-col gap-1",children:[e.jsx("p",{className:"loader"}),e.jsx("span",{children:"Reprogramando"})]}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("header",{className:"flex justify-between items-center py-2",children:e.jsxs("div",{children:[e.jsx(M,{children:"Reprogramar cita"}),e.jsx(P,{children:"Selecciona día"})]})}),e.jsx("div",{className:"flex flex-col pb-2 ",children:e.jsx(me,{selectedDate:x,setSelectedDate:v,moveSlotOffset:y})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Hora disponible"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:f.length===0?e.jsx("p",{className:"col-span-4 text-center text-gray-400",children:"No hay horarios disponibles para este día."}):f.map(h=>e.jsx(k,{variant:(a==null?void 0:a.id)===h.id?"default":"outline",className:$("h-12",(a==null?void 0:a.id)===h.id&&"bg-rose-500 hover:bg-rose-600",h.is_booked&&"opacity-50 cursor-not-allowed"),disabled:h.is_booked,onClick:()=>{!h.is_booked&&typeof h.id=="number"&&i({...h,id:h.id})},children:h.time},h.id))})]}),d&&e.jsx("div",{className:"p-4 my-4 border-l-4 bg-rose-100 text-rose-800 rounded-md shadow-sm",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:"Deberás abonar un cargo adicional por reprogramar con menos de 24 horas de anticipación."})})}),e.jsxs(k,{className:"w-full mt-4 bg-black hover:bg-gray-800 text-white",disabled:!a||a.is_booked,onClick:r,children:["Reprogramar"," ",a&&e.jsxs(e.Fragment,{children:["para ",new Date(a.date).toLocaleDateString("es-AR",{day:"numeric",month:"numeric",year:"2-digit"}),", ",a.time,"hs"]})]})]})})]})},_e=s=>{const[c,l]=m.useState(!1),{setCustomerAppointment:a}=m.useContext(T),i=()=>{l(N=>!N)},x=(N,g)=>{const C=new Date,S=new Date(N);S.setHours(0,0,0,0);const[_,R]=g.split(":").map(Number),t=new Date(S);t.setHours(_,R,0,0);const n=(t.getTime()-C.getTime())/(1e3*60*60);return n<=24&&n>0},[v,y,f]=m.useActionState(async(N,g)=>{let C=g.payment_percentage,_=g.products.reduce((t,o)=>t+o.price,0)*(C/100),R=C<100?_*(25/100):_*(75/100);try{await B(g.id,R)&&a(o=>o.map(n=>n.id===g.id?{...n,status:"cancelled"}:n)),i()}catch(t){console.warn("Error recargo reprogramación",t)}},null),[r,d,j]=m.useActionState(async(N,g)=>{let C=g.payment_percentage,_=g.products.reduce((t,o)=>t+o.price,0)*(C/100),R=C<100?_*(0/100):_*(50/100);try{await B(g.id,R)&&a(o=>o.map(n=>n.id===g.id?{...n,status:"cancelled"}:n)),i()}catch(t){console.warn("Error recargo reprogramación",t)}},null);return{isWithin24Hours:x,handleReschedule:()=>{if(!s)return;const N=x(s.slot.date,s.slot.time);m.startTransition(()=>{N?d(s):y(s)})},isOpen:c,handleIsOpen:i,isCancelWithCouponPending:f,isCancelApptPending:j,cancelWithCouponErr:v,cancelApptErr:r}};function De(s,c){return c?s<100?{couponPercentage:0,message:"Estás cancelando dentro de las 24 horas y perderás la reserva abonada."}:{couponPercentage:50,message:"Estás cancelando dentro de las 24 horas. Recibirás un cupón del 50% del total abonado."}:s<100?{couponPercentage:25,message:"Al cancelar con anticipación, recibirás un cupón del 25% del valor de tu reserva."}:{couponPercentage:75,message:"Recibirás un cupón del 75% del total abonado para tu próxima visita."}}const Se=({appointment:s})=>{const{isWithin24Hours:c,handleReschedule:l,isOpen:a,handleIsOpen:i,isCancelApptPending:x,isCancelWithCouponPending:v,cancelWithCouponErr:y,cancelApptErr:f}=_e(s),r=De(s.payment_percentage,c(s.slot.date,s.slot.time));return e.jsxs(z,{open:a,onOpenChange:i,children:[e.jsx(W,{asChild:!0,children:e.jsx("button",{children:"Cancelar"})}),e.jsx(F,{className:"sm:max-w-md",children:x||v?e.jsxs("div",{className:"w-full flex justify-center items-center flex-col gap-1",children:[e.jsx("p",{className:"loader"}),e.jsx("span",{children:"Cancelando"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(M,{children:"¿Cancelar turno?"}),e.jsx(P,{children:r.message})]}),(f||y)&&e.jsx("p",{className:"p-2 bg-red-600/10 text-red-500 border rounded-md text-sm",children:"Ocurrió un error cancelando la cita"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(k,{variant:"outline",onClick:i,children:"No, volver"}),e.jsx(k,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:l,children:"Sí, cancelar"})]})]})})]})},q=s=>`$${s.toFixed(2)}`,V=s=>new Date(s).toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"}),Ae=({appointment:s})=>{const[c,l]=m.useState(!1),i=(r=>{const d=new Date,j=new Date(r);return d<=j?{label:"Pendiente",color:"bg-yellow-500/10 text-yellow-400 border"}:{label:"Completado",color:"bg-lime-600/10 text-lime-500 border"}})(s.slot.date),x=s.products.reduce((r,d)=>r+d.price,0),v=s.payment_percentage/100*x,y=x-v,f=(()=>{const r=new Date(s.slot.date),[d,j]=s.slot.time.split(":").map(Number);return r.setHours(d),r.setMinutes(j),r.setSeconds(0),r.setMilliseconds(0),r>new Date})();return e.jsxs(ce,{className:"hover:bg-gray-50 rounded-lg cursor-pointer p-5 border-none  shadow-none",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(O,{className:`${s.status==="cancelled"?"bg-red-100 text-red-600 border border-red-200":i.color} text-xs`,children:s.status==="cancelled"?"Cancelado":i.label}),f&&s.status!=="cancelled"&&e.jsxs(X,{children:[e.jsx(Y,{children:e.jsx(je,{className:"text-zinc-500 hover:text-zinc-700"})}),e.jsxs(ee,{children:[e.jsx(se,{children:"Acciones"}),e.jsx(te,{}),e.jsx(L,{onSelect:r=>r.preventDefault(),asChild:!0,children:e.jsx("div",{children:e.jsx(Ce,{appointment:s})})}),e.jsx(L,{onSelect:r=>r.preventDefault(),asChild:!0,children:e.jsx("div",{children:e.jsx(Se,{appointment:s})})})]})]})]}),e.jsxs(ie,{open:c,children:[e.jsx(oe,{asChild:!0,children:e.jsxs("div",{className:"flex flex-col py-2 rounded px-2",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 rounded px-2 cursor-pointer hover:bg-gray-100",onClick:()=>l(r=>!r),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-gray-700"}),e.jsxs("span",{className:"text-sm text-gray-800",children:[V(s.slot.date)," - ",s.slot.time]})]}),c?e.jsx(re,{className:"w-4 h-4 text-gray-600"}):e.jsx(ne,{className:"w-4 h-4 text-gray-600"})]}),new Date>new Date(s.slot.date)&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-gray-50",children:s.review?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.review.comment}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((r,d)=>e.jsx(G,{className:`h-4 w-4 ${d<s.review.rating?"text-yellow-300 fill-yellow-400":"text-gray-300"}`},d))})]}):s.status!=="cancelled"&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"¿Qué te pareció el servicio?"}),e.jsx(fe,{appointment:s})]})})]})}),e.jsxs(le,{className:"pt-4 mx-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col border-t border-gray-200 pt-2",children:[e.jsx("span",{className:"text-gray-500",children:"Seleccionaste:"}),s.products.map(r=>e.jsx("div",{className:"flex justify-between",children:e.jsx("span",{children:r.name})},r.id))]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500",children:["Pagado (",s.payment_percentage,"%):"]}),e.jsx(O,{className:"bg-lime-100 text-lime-600 border border-lime-200",children:q(v)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Pendiente:"}),e.jsx(O,{className:"bg-red-100 text-red-600 border border-red-200",children:q(y)})]})]})})]}),e.jsx("div",{className:"flex gap-2 mt-6 pt-4 border-t border-gray-200",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Solicitada: ",V(s.created_at)]})})]})]})]})},Re=()=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-1",children:"Mis citas"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tu historial de reservas"})]}),He=()=>{const{customerAppointment:s}=he();return e.jsx("section",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsx(Re,{}),e.jsx("div",{className:"space-y-4",children:Array.isArray(s)&&s.length>0?e.jsx(e.Fragment,{children:s.map((c,l)=>e.jsxs("div",{children:[e.jsx(Ae,{appointment:c},l),l<s.length-1&&e.jsx("div",{className:"border-b border-gray-100 mx-2"})]},c.id))}):e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-3 text-slate-100"}),e.jsx("p",{children:"No tienes citas pendientes"}),e.jsx("a",{href:"/reservation",className:"mt-2 inline-block text-sm font-semibold text-rose-500 hover:text-rose-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-500 transition-colors",children:"Programar nueva cita"})]})})})]})})};export{He as default};
