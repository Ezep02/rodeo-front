import{c as J,A as E,r as l,ae as T,V as K,d as Q,j as e,F as $,Z as W,g as O,H as F,I as q,J as Z,K as P,M as H,E as X,B as z,af as Y,ag as ee,ah as se,ai as te,aj as ne,ak as L}from"./index-AL-VPenz.js";import{u as re,S as ae}from"./ScheduleSlider-D3Hr_vam.js";import{C as oe}from"./card-DXiLM1pq.js";import{b as ie,a as ce,f as le}from"./getAppointmentStatus-DxMMHfZL.js";import{b as de,c as me,d as ue,e as pe}from"./index-DOOy_dnx.js";import{C as xe}from"./reviews_service-B1CMHQG9.js";import{c as he}from"./index-CYxorXPt.js";import{S as ge}from"./star-gQmunR2o.js";import{u as fe}from"./useSlots-Bc6p4izx.js";import{C as je}from"./calendar-D5FUtbTF.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),B="http://localhost:9090/api/v1/appointments",be=async s=>(await E.get(`${B}/user/${s}`)).data.appointments,V=async(s,a)=>(await E.post(`${B}/cancel/${s}`,{data:{recharge:a}})).data,we=()=>{const{user:s}=re(),{setCustomerAppointment:a,customerAppointment:c}=l.useContext(T);return l.useEffect(()=>{(async()=>{if((s==null?void 0:s.ID)!==void 0)try{const o=await be(s.ID);o.length>0&&a(o)}catch(o){console.log(o)}})()},[]),{customerAppointment:c}};function ve(s){return K({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M899.4 638.2h-27.198c-2.2-.6-4.2-1.6-6.4-2-57.2-8.8-102.4-56.4-106.2-112.199-4.401-62.4 31.199-115.2 89.199-132.4 7.6-2.2 15.6-3.8 23.399-5.8h27.2c1.8.6 3.4 1.6 5.4 1.8 52.8 8.6 93 46.6 104.4 98.6.8 4 2 8 3 12v27.2c-.6 1.8-1.6 3.6-1.8 5.4-8.4 52-45.4 91.599-96.801 103.6-5 1.2-9.6 2.6-14.2 3.8zM130.603 385.8l27.202.001c2.2.6 4.2 1.6 6.4 1.8 57.6 9 102.6 56.8 106.2 113.2 4 62.2-32 114.8-90.2 131.8-7.401 2.2-15 3.8-22.401 5.6h-27.2c-1.8-.6-3.4-1.6-5.2-2-52-9.6-86-39.8-102.2-90.2-2.2-6.6-3.4-13.6-5.2-20.4v-27.2c.6-1.8 1.6-3.6 1.8-5.4 8.6-52.2 45.4-91.6 96.8-103.6 4.8-1.201 9.4-2.401 13.999-3.601zm370.801.001h27.2c2.2.6 4.2 1.6 6.4 2 57.4 9 103.6 58.6 106 114.6 2.8 63-35.2 116.4-93.8 131.4-6.2 1.6-12.4 3-18.6 4.4h-27.2c-2.2-.6-4.2-1.6-6.4-2-57.4-8.8-103.601-58.6-106.2-114.6-3-63 35.2-116.4 93.8-131.4 6.4-1.6 12.6-3 18.8-4.4z"},child:[]}]})(s)}const Ne=({appointment:s})=>{const[a,c]=l.useState(!1),[t,o]=l.useState([]),[g,y]=l.useState(""),[C,f]=l.useState(!1),j=()=>{c(r=>!r)},{register:b,handleSubmit:S,watch:p,setValue:w}=Q({defaultValues:{comment:"",rating:0}}),d=p("comment"),_=p("rating"),R=r=>{const m=t.includes(r),v=m?t.filter(h=>h!==r):[...t,r];if(o(v),m){const h=new RegExp(`\\s*${r}`,"g"),N=d.replace(h,"").trim();w("comment",N)}else{const h=d&&!d.trim().endsWith(".")&&!d.endsWith(" ")?" ":"";w("comment",`${d}${h}${r}`)}},{setCustomerAppointment:D}=l.useContext(T),[I,x,i]=l.useActionState(async(r,m)=>{var N;const{comment:v,rating:h}=m;try{const u={appointment_id:s.id,comment:v,rating:h},k=await xe(u);k&&D(G=>G.map(M=>M.id===s.id?{...M,review:{id:0,comment:k.review.comment,rating:k.review.rating,appointmentID:k.review.appointment_id}}:M)),j()}catch(u){console.log(u),y(((N=u==null?void 0:u.data)==null?void 0:N.error)||"error creando review"),f(!0)}},null),n=r=>{l.startTransition(()=>{x(r)})},A=["Excelente atención","Muy profesional","Ambiente agradable","Buen precio","Lo recomiendo"];return e.jsxs($,{open:a,onOpenChange:j,children:[e.jsx(W,{asChild:!0,children:e.jsx("div",{className:"flex gap-2 mb-2",children:[1,2,3,4,5].map(r=>e.jsx("button",{type:"button",onClick:()=>w("rating",r),className:"transition-transform duration-200 hover:scale-110",children:e.jsx(ge,{className:O("h-5 w-5 transition-colors",r<=_?"text-amber-400 fill-amber-400":"text-slate-200")})},r))})}),e.jsxs(F,{className:`w-full h-full p-6 bg-zinc-50 flex flex-col\r
                           overflow-y-auto shadow-2xl md:rounded-3xl\r
                           max-w-full  \r
                           md:max-w-xl md:max-h-[60vh] md:min-h-[40vh]`,children:[e.jsxs(q,{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:j,children:e.jsx(Z,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-xl font-bold text-zinc-800",children:"Reseña"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(he,{size:24})}),e.jsxs("div",{children:[e.jsx(P,{className:"text-lg font-semibold text-zinc-700 text-start",children:"¿Cómo te fue? Podés dejar tu reseña acá."}),e.jsx(H,{className:"text-zinc-600 mt-1 text-start",children:"Tu opinión es importante para que podamos seguir mejorando nuestros servicios"})]})]})]}),e.jsx(X,{message:g,show:C,onClose:()=>f(!1)}),e.jsxs("form",{onSubmit:S(n),className:"flex flex-col flex-grow gap-6",children:[i&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-rose-500 border-t-transparent rounded-full animate-spin"}),e.jsxs(P,{className:"text-center text-lg font-semibold text-slate-800 flex items-center gap-2",children:["Enviando Reseña",e.jsx(U,{className:"w-5 h-5 text-rose-500"})]}),e.jsx(H,{children:"Esto puede tardar unos segundos..."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"comment",className:"text-sm font-medium text-zinc-600",children:"Comentario"}),e.jsx("textarea",{id:"comment",rows:5,placeholder:"¿Cómo fue tu experiencia?",className:"w-full p-3 text-sm text-zinc-900 bg-white border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-rose-500 placeholder-zinc-400",...b("comment"),disabled:i})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-600",children:"Etiquetas rápidas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(r=>e.jsx(z,{type:"button",variant:t.includes(r)?"default":"outline",className:O("h-8 text-xs transition",t.includes(r)?"bg-rose-500 hover:bg-rose-600 text-white":"border-gray-300 text-zinc-600 hover:border-rose-400 hover:text-rose-500"),onClick:()=>R(r),disabled:i,children:r},r))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(z,{type:"button",variant:"ghost",onClick:()=>c(!1),disabled:i,className:"flex-1 border border-gray-300 text-zinc-600 hover:text-zinc-700 hover:border-zinc-400",children:"Cancelar"}),e.jsx(z,{type:"submit",disabled:_===0||i,className:"flex-1 bg-rose-500 hover:bg-rose-600 text-white gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4"}),"Enviar Reseña"]})})]})]})]})]})},ye="http://localhost:9090/api/v1/appointments",Ce="http://localhost:9090/api/v1/mercado_pago",_e=async(s,a,c)=>{let t={new_slot_id:c,old_slot_id:a};return(await E.put(`${ye}/${s}`,t)).data},De=async s=>(await E.post(`${Ce}/surcharge`,s)).data,Se=s=>{const{setCustomerAppointment:a}=l.useContext(T),[c,t]=l.useState(!1),[o,g]=l.useState(void 0),{filteredSlots:y,setSlotDate:C,slotDate:f,MoveSlotOffset:j,setHashMap:b}=fe(),S=(i,n)=>{const A=new Date,r=new Date(i);r.setHours(0,0,0,0);const[m,v]=n.split(":").map(Number),h=new Date(r);h.setHours(m,v,0,0);const u=(h.getTime()-A.getTime())/(1e3*60*60);return u<=24&&u>0},[p,w,d]=l.useActionState(async(i,n)=>{try{await _e(n.appointment.id,n.appointment.slot.id,n.slot_to_replace.id)&&(b(r=>{const m=new Map(r);for(const[v,h]of m.entries()){const N=h.map(u=>u.id===n.appointment.slot.id?{...u,is_booked:!1}:u.id===n.slot_to_replace.id?{...u,is_booked:!0}:u);m.set(v,N)}return m}),a(r=>{const m=[...r],v=m.findIndex(h=>h.id===n.appointment.id);return v!==-1&&(m[v]={...m[v],slot:{...n.slot_to_replace,is_booked:!0}}),m}),g(void 0),t(!1))}catch(A){console.warn("Algo no fue bien",A)}},null),_=()=>{t(i=>!i)},R=()=>{if(!o)return;const i=S(s.slot.date,s.slot.time);l.startTransition(()=>{i?I({appointment:s,slot_to_replace:o}):w({appointment:s,slot_to_replace:o})})},[D,I,x]=l.useActionState(async(i,n)=>{let A=n.appointment.payment_percentage,m=n.appointment.products.reduce((N,u)=>N+u.price,0)*(A/100),v=A<100?m*(50/100):m*(25/100),h={appointment_id:n.appointment.id,new_slot_id:n.slot_to_replace.id,old_slot_id:n.appointment.slot.id,surcharge_price:v};try{let N=await De(h);window.location.href=N.init_point}catch(N){console.warn("Error recargo reprogramación",N)}},null);return{isOpen:c,toggleDialog:_,selectedTime:o,setSelectedTime:g,setSlotDate:C,slotDate:f,MoveSlotOffset:j,filteredSlots:y,handleReschedule:R,isWithin24Hours:S(s.slot.date,s.slot.time),isReschedulingPending:d||x,reschedulingErr:p,surchargeErr:D}},Ae=({appointment:s})=>{const{isOpen:a,toggleDialog:c,selectedTime:t,setSelectedTime:o,setSlotDate:g,slotDate:y,MoveSlotOffset:C,filteredSlots:f,handleReschedule:j,isWithin24Hours:b,isReschedulingPending:S}=Se(s);return e.jsxs($,{open:a,onOpenChange:c,children:[e.jsx(W,{asChild:!0,children:e.jsx("button",{children:"Reprogramar"})}),e.jsx(F,{children:S?e.jsxs("div",{className:"w-full flex justify-center items-center flex-col gap-1",children:[e.jsx("p",{className:"loader"}),e.jsx("span",{children:"Reprogramando"})]}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-col pb-2 ",children:e.jsx(ae,{title:"Reprogramar cita",description:"Selecciona día",selectedDate:y,setSelectedDate:g,moveApptOffset:C})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Hora disponible"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:f.length===0?e.jsx("p",{className:"col-span-4 text-center text-gray-400",children:"No hay horarios disponibles para este día."}):f.map(p=>e.jsx(z,{variant:(t==null?void 0:t.id)===p.id?"default":"outline",className:O("h-12",(t==null?void 0:t.id)===p.id&&"bg-rose-500 hover:bg-rose-600",p.is_booked&&"opacity-50 cursor-not-allowed"),disabled:p.is_booked,onClick:()=>{!p.is_booked&&typeof p.id=="number"&&o({...p,id:p.id})},children:p.time},p.id))})]}),b&&e.jsx("div",{className:"p-4 my-4 border-l-4 bg-rose-100 text-rose-800 rounded-md shadow-sm",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:"Deberás abonar un cargo adicional por reprogramar con menos de 24 horas de anticipación."})})}),e.jsxs(z,{className:"w-full mt-4 bg-black hover:bg-gray-800 text-white",disabled:!t||t.is_booked,onClick:j,children:["Reprogramar"," ",t&&e.jsxs(e.Fragment,{children:["para ",new Date(t.date).toLocaleDateString("es-AR",{day:"numeric",month:"numeric",year:"2-digit"}),", ",t.time,"hs"]})]})]})})]})},Re=s=>{const[a,c]=l.useState(!1),{setCustomerAppointment:t}=l.useContext(T),o=()=>{c(w=>!w)},g=(w,d)=>{const _=new Date,R=new Date(w);R.setHours(0,0,0,0);const[D,I]=d.split(":").map(Number),x=new Date(R);x.setHours(D,I,0,0);const n=(x.getTime()-_.getTime())/(1e3*60*60);return n<=24&&n>0},[y,C,f]=l.useActionState(async(w,d)=>{let _=d.payment_percentage,D=d.products.reduce((x,i)=>x+i.price,0)*(_/100),I=_<100?D*(25/100):D*(75/100);try{await V(d.id,I)&&t(i=>i.map(n=>n.id===d.id?{...n,status:"cancelled"}:n)),o()}catch(x){console.warn("Error recargo reprogramación",x)}},null),[j,b,S]=l.useActionState(async(w,d)=>{let _=d.payment_percentage,D=d.products.reduce((x,i)=>x+i.price,0)*(_/100),I=_<100?D*(0/100):D*(50/100);try{await V(d.id,I)&&t(i=>i.map(n=>n.id===d.id?{...n,status:"cancelled"}:n)),o()}catch(x){console.warn("Error recargo reprogramación",x)}},null);return{isWithin24Hours:g,handleReschedule:()=>{if(!s)return;const w=g(s.slot.date,s.slot.time);l.startTransition(()=>{w?b(s):C(s)})},isOpen:a,handleIsOpen:o,isCancelWithCouponPending:f,isCancelApptPending:S,cancelWithCouponErr:y,cancelApptErr:j}};function Ie(s,a){return a?s<100?{couponPercentage:0,message:"Estás cancelando dentro de las 24 horas y perderás la reserva abonada."}:{couponPercentage:50,message:"Estás cancelando dentro de las 24 horas. Recibirás un cupón del 50% del total abonado."}:s<100?{couponPercentage:25,message:"Al cancelar con anticipación, recibirás un cupón del 25% del valor de tu reserva."}:{couponPercentage:75,message:"Recibirás un cupón del 75% del total abonado para tu próxima visita."}}const ze=({appointment:s})=>{const{isWithin24Hours:a,handleReschedule:c,isOpen:t,handleIsOpen:o,isCancelApptPending:g,isCancelWithCouponPending:y,cancelWithCouponErr:C,cancelApptErr:f}=Re(s),j=Ie(s.payment_percentage,a(s.slot.date,s.slot.time));return e.jsxs($,{open:t,onOpenChange:o,children:[e.jsx(W,{asChild:!0,children:e.jsx("button",{children:"Cancelar"})}),e.jsx(F,{className:"sm:max-w-md",children:g||y?e.jsxs("div",{className:"w-full flex justify-center items-center flex-col gap-1",children:[e.jsx("p",{className:"loader"}),e.jsx("span",{children:"Cancelando"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(P,{children:"¿Cancelar turno?"}),e.jsx(H,{children:j.message})]}),(f||C)&&e.jsx("p",{className:"p-2 bg-red-600/10 text-red-500 border rounded-md text-sm",children:"Ocurrió un error cancelando la cita"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(z,{variant:"outline",onClick:o,children:"No, volver"}),e.jsx(z,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:c,children:"Sí, cancelar"})]})]})})]})},ke=(s,a,c)=>{const t=new Date(a),[o,g]=c.split(":").map(Number);if(t.setHours(o,g,0,0),t>new Date&&s!=="cancelled")return{icon:e.jsx(de,{className:"text-yellow-500 w-5 h-5"}),label:"Pendiente"};switch(s){case"active":return{icon:e.jsx(pe,{className:"text-green-500 w-5 h-5"}),label:"Atendido"};case"cancelled":return{icon:e.jsx(ue,{className:"text-red-500 w-5 h-5"}),label:"Cancelada"};case"updated":return{icon:e.jsx(me,{className:"text-blue-500 w-5 h-5"}),label:"Reprogramada"};default:return{icon:null,label:"Sin estado"}}},Ee=({appointment:s})=>{const a=s.products.reduce((b,S)=>b+S.price,0),c=s.payment_percentage/100*a,t=new Date(s.slot.date),[o,g]=s.slot.time.split(":").map(Number);t.setHours(o,g,0,0);const y=t>new Date,C=ie(s.payment_percentage),{icon:f,label:j}=ke(s.status,t,s.slot.time);return e.jsxs(oe,{className:"rounded-2xl border-none shadow-none p-5 bg-white flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f,e.jsx("span",{className:"text-sm text-zinc-600",children:j})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-zinc-800 font-semibold text-base",children:new Date(s.slot.date).toLocaleDateString("es-AR",{weekday:"long",day:"2-digit",month:"short",year:"numeric"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-600",children:[e.jsx(ce,{className:"text-lg"}),e.jsx("span",{children:le(s.slot.time)})]}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["$",c.toFixed(0)," / $",a.toFixed(0)]})]}),y&&s.status!=="cancelled"&&e.jsxs(Y,{children:[e.jsx(ee,{children:e.jsx(ve,{className:"text-zinc-500 hover:text-zinc-700"})}),e.jsxs(se,{align:"end",children:[e.jsx(te,{children:"Acciones"}),e.jsx(ne,{}),e.jsx(L,{onSelect:b=>b.preventDefault(),children:e.jsx(Ae,{appointment:s})}),e.jsx(L,{onSelect:b=>b.preventDefault(),children:e.jsx(ze,{appointment:s})})]})]})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${C.className}`,children:C.label})}),new Date>t&&!s.review&&e.jsx("section",{className:"bg-zinc-50 p-3 rounded-lg flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("p",{className:"text-sm text-zinc-700",children:"¿Qué te pareció el servicio?"}),e.jsx(Ne,{appointment:s})]})}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"text-sm text-primary underline underline-offset-4 hover:text-primary/80 transition",onClick:()=>console.log("Ver más detalles de",s.id),children:"Ver detalles"})})]})},Ve=()=>{const{customerAppointment:s}=we();return e.jsx("section",{className:"flex  border-gray-200 grow",children:e.jsx("div",{className:"flex flex-col flex-grow",children:e.jsx("div",{className:"space-y-4",children:Array.isArray(s)&&s.length>0?e.jsx(e.Fragment,{children:s.map((a,c)=>e.jsxs("div",{children:[e.jsx(Ee,{appointment:a},c),c<s.length-1&&e.jsx("div",{className:"border-b border-gray-100 mx-2"})]},a.id))}):e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-3 text-rose-400"}),e.jsx("p",{className:"text-gray-700",children:"No tienes citas pendientes"}),e.jsx("a",{href:"/reservation",className:"mt-2 inline-block text-sm font-medium text-gray-900 hover:underline focus:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 transition",children:"Programar nueva cita"})]})})})})})};export{Ve as default};
