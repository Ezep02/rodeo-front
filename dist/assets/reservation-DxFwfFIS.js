import{h as H,A as _,r as i,D as M,j as e,k as P,C as D,b,L as k,B as h}from"./index-DhWYa8W4.js";import{C as v}from"./card-Dsn8Ms4I.js";import{u as I,D as U,b as q,c as G,d as J,C as K,g as Q}from"./useSlots-ChQCJa-Q.js";import{u as V}from"./useUser-CJqXQwqe.js";import{C as W}from"./calendar-1-DPB1Znho.js";import{C as X}from"./credit-card-DsjZJXe4.js";import"./x-Drps6sCP.js";function Y(n){return H({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.115 16.479a.93.927 0 0 1-.939-.886c-.002-.042-.006-.155-.103-.155-.04 0-.074.023-.113.059-.112.103-.254.206-.46.206a.816.814 0 0 1-.305-.066c-.535-.214-.542-.578-.521-.725.006-.038.007-.08-.02-.11l-.032-.03h-.034c-.027 0-.055.012-.093.039a.788.786 0 0 1-.454.16.7.699 0 0 1-.253-.05c-.708-.27-.65-.928-.617-1.126.005-.041-.005-.072-.03-.092l-.05-.04-.047.043a.728.726 0 0 1-.505.203.73.728 0 0 1-.732-.725c0-.4.328-.722.732-.722.364 0 .675.27.721.63l.026.195.11-.165c.01-.018.307-.46.852-.46.102 0 .21.016.316.05.434.13.508.52.519.68.008.094.075.1.09.1.037 0 .064-.024.083-.045a.746.744 0 0 1 .54-.225c.128 0 .263.03.402.09.69.293.379 1.158.374 1.167-.058.144-.061.207-.005.244l.027.013h.02c.03 0 .07-.014.134-.035.093-.032.235-.08.367-.08a.944.942 0 0 1 .94.93.936.934 0 0 1-.94.928zm7.302-4.171c-1.138-.98-3.768-3.24-4.481-3.77-.406-.302-.685-.462-.928-.533a1.559 1.554 0 0 0-.456-.07c-.182 0-.376.032-.58.095-.46.145-.918.505-1.362.854l-.023.018c-.414.324-.84.66-1.164.73a1.986 1.98 0 0 1-.43.049c-.362 0-.687-.104-.81-.258-.02-.025-.007-.066.04-.125l.008-.008 1-1.067c.783-.774 1.525-1.506 3.23-1.545h.085c1.062 0 2.12.469 2.24.524a7.03 7.03 0 0 0 3.056.724c1.076 0 2.188-.263 3.354-.795a9.135 9.11 0 0 0-.405-.317c-1.025.44-2.003.66-2.946.66-.962 0-1.925-.229-2.858-.68-.05-.022-1.22-.567-2.44-.57-.032 0-.065 0-.096.002-1.434.033-2.24.536-2.782.976-.528.013-.982.138-1.388.25-.361.1-.673.186-.979.185-.125 0-.35-.01-.37-.012-.35-.01-2.115-.437-3.518-.962-.143.1-.28.203-.415.31 1.466.593 3.25 1.053 3.812 1.089.157.01.323.027.491.027.372 0 .744-.103 1.104-.203.213-.059.446-.123.692-.17l-.196.194-1.017 1.087c-.08.08-.254.294-.14.557a.705.703 0 0 0 .268.292c.243.162.677.27 1.08.271.152 0 .297-.015.43-.044.427-.095.874-.448 1.349-.82.377-.296.913-.672 1.323-.782a1.494 1.49 0 0 1 .37-.05.611.61 0 0 1 .095.005c.27.034.533.125 1.003.472.835.62 4.531 3.815 4.566 3.846.002.002.238.203.22.537-.007.186-.11.352-.294.466a.902.9 0 0 1-.484.15.804.802 0 0 1-.428-.124c-.014-.01-1.28-1.157-1.746-1.543-.074-.06-.146-.115-.22-.115a.122.122 0 0 0-.096.045c-.073.09.01.212.105.294l1.48 1.47c.002 0 .184.17.204.395.012.244-.106.447-.35.606a.957.955 0 0 1-.526.171.766.764 0 0 1-.42-.127l-.214-.206a21.035 20.978 0 0 0-1.08-1.009c-.072-.058-.148-.112-.221-.112a.127.127 0 0 0-.094.038c-.033.037-.056.103.028.212a.698.696 0 0 0 .075.083l1.078 1.198c.01.01.222.26.024.511l-.038.048a1.18 1.178 0 0 1-.1.096c-.184.15-.43.164-.527.164a.8.798 0 0 1-.147-.012c-.106-.018-.178-.048-.212-.089l-.013-.013c-.06-.06-.602-.609-1.054-.98-.059-.05-.133-.11-.21-.11a.128.128 0 0 0-.096.042c-.09.096.044.24.1.293l.92 1.003a.204.204 0 0 1-.033.062c-.033.044-.144.155-.479.196a.91.907 0 0 1-.122.007c-.345 0-.712-.164-.902-.264a1.343 1.34 0 0 0 .13-.576 1.368 1.365 0 0 0-1.42-1.357c.024-.342-.025-.99-.697-1.274a1.455 1.452 0 0 0-.575-.125c-.146 0-.287.025-.42.075a1.153 1.15 0 0 0-.671-.564 1.52 1.515 0 0 0-.494-.085c-.28 0-.537.08-.767.242a1.168 1.165 0 0 0-.903-.43 1.173 1.17 0 0 0-.82.335c-.287-.217-1.425-.93-4.467-1.613a17.39 17.344 0 0 1-.692-.189 4.822 4.82 0 0 0-.077.494l.67.157c3.108.682 4.136 1.391 4.309 1.525a1.145 1.142 0 0 0-.09.442 1.16 1.158 0 0 0 1.378 1.132c.096.467.406.821.879 1.003a1.165 1.162 0 0 0 .415.08c.09 0 .179-.012.266-.034.086.22.282.493.722.668a1.233 1.23 0 0 0 .457.094c.122 0 .241-.022.355-.063a1.373 1.37 0 0 0 1.269.841c.37.002.726-.147.985-.41.221.121.688.341 1.163.341.06 0 .118-.002.175-.01.47-.059.689-.24.789-.382a.571.57 0 0 0 .048-.078c.11.032.234.058.373.058.255 0 .501-.086.75-.265.244-.174.418-.424.444-.637v-.01c.083.017.167.026.251.026.265 0 .527-.082.773-.242.48-.31.562-.715.554-.98a1.28 1.279 0 0 0 .978-.194 1.04 1.04 0 0 0 .502-.808 1.088 1.085 0 0 0-.16-.653c.804-.342 2.636-1.003 4.795-1.483a4.734 4.721 0 0 0-.067-.492 27.742 27.667 0 0 0-5.049 1.62zm5.123-.763c0 4.027-5.166 7.293-11.537 7.293-6.372 0-11.538-3.266-11.538-7.293 0-4.028 5.165-7.293 11.539-7.293 6.371 0 11.537 3.265 11.537 7.293zm.46.004c0-4.272-5.374-7.755-12-7.755S.002 7.277.002 11.55L0 12.004c0 4.533 4.695 8.203 11.999 8.203 7.347 0 12-3.67 12-8.204z"},child:[]}]})(n)}const Z="http://localhost:9090/api/v1/mercado_pago",T=async n=>(await _.post(`${Z}/`,n)).data,ee="http://localhost:9090/api/v1/products",se=async()=>(await _.get(`${ee}/`)).data,ae=()=>{const{productShop:n,setProductShop:d}=i.useContext(M);return i.useEffect(()=>{(async()=>{try{const o=await se();o.products&&d(o.products)}catch(o){console.warn("Product shop err",o)}})()},[]),{productShop:n}},de=()=>{const[n,d]=i.useState(!1),[t,o]=i.useState(),[r,u]=i.useState(1),[a,j]=i.useState(),[g,y]=i.useState(!1),[p,L]=i.useState("100"),{productShop:w}=ae(),{user:f}=V(),{date:m,filteredSlots:N,setDate:F,MoveSlotOffset:R}=I(),$=s=>{o(s),d(!0)},C=()=>{z(),d(!1)},z=()=>{u(1),j(void 0)},S=[{id:1,title:"Fecha & Hora",icon:W},{id:2,title:"Confirmación",icon:D},{id:3,title:"Pago",icon:X}],B=()=>{switch(r){case 1:return m!==null&&a!==void 0&&!g;case 2:return!0;case 3:return!0;default:return!1}},O=s=>{L(s.target.value)},A=(s,c)=>{const l=parseFloat(s);return isNaN(l)?c:l/100*c},E=async()=>{if(!t||!f||!a)return;const s=[t.id],c=N.find(x=>x.id===a.id),l={customer_name:f.name,customer_surname:f.surname,date:a.date instanceof Date?a.date.toISOString():String(a.date),payment_percentage:Number(p),products:s,slotID:a.id,time:c?c.time:""};try{y(!0);const x=await T(l);window.location.href=x.init_point}catch(x){console.error("Error creando link de pago",x)}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pt-20",children:[e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(v,{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Servicios"}),e.jsx("div",{className:"space-y-1",children:w.map((s,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between py-4 px-2 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer group",onClick:()=>$(s),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-green-400",children:["$",s.price]}),e.jsx(P,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"})]})]}),c<w.length-1&&e.jsx("div",{className:"border-b border-gray-100 mx-2"})]},s.id))})]})})}),e.jsx(U,{open:n,onOpenChange:C,children:e.jsxs(q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(G,{children:e.jsx(J,{className:"text-xl font-semibold",children:"Reservar Cita"})}),e.jsx("div",{className:"flex items-center justify-between mb-8 px-4",children:S.map((s,c)=>{const l=s.id===1?m!==null&&a!==void 0:r>s.id;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:b("w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all",r===s.id?"bg-rose-500 border-rose-500 text-white":l?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-400"),children:l?e.jsx(D,{className:"w-5 h-5"}):e.jsx(s.icon,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs mt-2 font-medium text-gray-600",children:s.title})]}),c<S.length-1&&e.jsx("div",{className:b("w-16 h-0.5 mx-4 transition-all",r>s.id?"bg-green-500":"bg-gray-200")})]},s.id)})}),r===1&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Selecciona fecha y hora"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Fecha"}),e.jsx("div",{className:"overflow-hidden max-w-xl",children:e.jsx(K,{selectedDate:m,setSelectedDate:s=>{F(s),j(void 0)},moveSlotOffset:R})})]}),e.jsx("h4",{className:"font-medium mb-3",children:"Hora disponible"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:g?e.jsxs("div",{className:"col-span-4 flex justify-center items-center",children:[e.jsx(k,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-500 text-sm",children:"Cargando horarios..."})]}):N.length===0?e.jsx("p",{className:"col-span-4 text-center text-gray-400",children:"No hay horarios disponibles para este día."}):N.map(s=>e.jsx(h,{variant:(a==null?void 0:a.id)===s.id?"default":"outline",className:b("h-12",(a==null?void 0:a.id)===s.id&&"bg-rose-500 hover:bg-rose-600",s.is_booked&&"opacity-50 cursor-not-allowed"),disabled:s.is_booked,onClick:()=>{!s.is_booked&&typeof s.id=="number"&&j({...s,id:s.id})},children:s.time},s.id))})]}),r===2&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirma tu reserva"}),e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Servicio:"}),e.jsx("span",{children:t==null?void 0:t.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha:"}),e.jsx("span",{children:m?new Date(m).toLocaleDateString():"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Hora:"}),e.jsx("span",{children:(a==null?void 0:a.time)||"-"})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500",children:"Seña:"}),e.jsxs("select",{value:p,onChange:O,required:!0,children:[e.jsx("option",{value:"100",children:"No"}),e.jsx("option",{value:"50",children:"Sí"})]})]}),e.jsxs("div",{className:"border-t pt-4 font-semibold flex justify-between text-lg items-center",children:[e.jsx("span",{children:"Total:"}),e.jsx("div",{className:"flex flex-col text-right",children:p==="50"&&t?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"line-through text-gray-500",children:["$",t.price]}),e.jsxs("span",{className:"text-green-500",children:["$",A(p,t.price)]})]}):e.jsxs("span",{className:"text-green-500",children:["$",t==null?void 0:t.price]})})]})]})})]}),r===3&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Método de pago"}),e.jsx(v,{className:"p-4 mb-3 cursor-pointer hover:bg-gray-50 border-2 border-rose-500 bg-rose-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{size:25}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Mercado Pago"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Acredita el pago online"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs(h,{variant:"outline",onClick:()=>u(r-1),disabled:r===1,className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",onClick:C,children:"Cancelar"}),r<3?e.jsxs(h,{onClick:()=>u(r+1),disabled:!B(),className:"bg-rose-500 hover:bg-rose-600 flex items-center gap-2",children:["Siguiente ",e.jsx(P,{className:"w-4 h-4"})]}):e.jsx(h,{className:"bg-green-600 hover:bg-green-700",onClick:E,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-6 h-6 animate-spin text-zinc-200"}),e.jsx("span",{className:"text-zinc-50 text-sm",children:"Procesando..."})]}):e.jsx("span",{children:"Confirmar Reserva"})})]})]})]})})]})};export{de as default};
