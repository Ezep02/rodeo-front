import{A as x,r,j as e,B as p,V as f,F as g,H as j,I as N,J as w,K as C,M as v}from"./index-AL-VPenz.js";import{C as b,c as y}from"./card-DXiLM1pq.js";import{G as z}from"./index-Bz9dQuiV.js";import{F as R,L as B}from"./index-D7hatq2D.js";import{I as D}from"./index-DOOy_dnx.js";const h="http://localhost:9090/api/v1",S=async()=>(await x.get(`${h}/analytics/booking-rate`)).data,E=async()=>(await x.get(`${h}/info/`)).data,I=async()=>(await x.get(`${h}/posts/count`)).data,M=async()=>(await x.get(`${h}/analytics/client-rate`)).data,P=()=>{const[s,o]=r.useState();r.useEffect(()=>{(async()=>{try{let a=await E();a&&o(a.info)}catch{console.warn("ERROR recuperando informacion")}})()},[]);const[n,t]=r.useState(0);r.useEffect(()=>{(async()=>{try{let a=await I();a&&t(a.total_post)}catch(a){console.warn("Algo fue mal recuperando el rate de clientes",a)}})()},[]);const[c,l]=r.useState([]);r.useEffect(()=>{(async()=>{try{let a=await M();a&&l(a.month_client_rate)}catch(a){console.warn("Algo fue mal recuperando el rate de clientes",a)}})()},[]);const[d,i]=r.useState();return r.useEffect(()=>{(async()=>{try{let a=await S();a&&i(a.ocupation_rate)}catch(a){console.warn("GetBookingOcupationRate err:",a)}})()},[]),{clientRate:c,barberInformation:s,totalPost:n,ocupationRate:d}},u=({content:s,description:o,icon:n,title:t,callToAction:c,visibleButton:l})=>e.jsx(b,{className:"p-4 shadow-sm border border-zinc-200",children:e.jsx(y,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:n}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-zinc-800",children:t}),e.jsx("p",{className:"text-sm text-zinc-500",children:o})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-2xl font-medium text-zinc-700",children:s}),l&&e.jsxs(p,{size:"sm",variant:"outline",onClick:c,className:"text-xs rounded-2xl",children:[e.jsx(z,{}),"Ver"]})]})]})})});function A(s){return f({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 0.5C18.3513 0.5 23.5 5.64873 23.5 12C23.5 12.3369 23.4855 12.6704 23.4571 13H21.9506C21.4489 18.0533 17.1853 22 12 22C6.47715 22 2 17.5228 2 12C2 6.81465 5.94668 2.5511 11 2.04938V0.542876C11.3296 0.514488 11.6631 0.5 12 0.5ZM11 4.06189C7.05369 4.55399 4 7.92038 4 12C4 16.4183 7.58172 20 12 20C16.0796 20 19.446 16.9463 19.9381 13H11V4.06189ZM13 2.552V11H21.448C20.9827 6.55197 17.448 3.01732 13 2.552Z"},child:[]}]})(s)}const _=({month_client_rate:s})=>{const o=s.slice().sort((t,c)=>t.month.localeCompare(c.month)).map(t=>{const[c,l]=t.month.split("-").map(Number),i=new Date(c,l-1).toLocaleString("es-ES",{month:"short"});return{mes:i.charAt(0).toUpperCase()+i.slice(1),usuarios:t.new_clients,rawMonth:t.month}}),n=Math.max(...o.map(t=>t.usuarios));return e.jsx("div",{className:"space-y-4 max-h-full overflow-y-auto",children:e.jsx("div",{className:"space-y-2 px-1",children:o.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-16 text-sm text-zinc-600",children:t.mes}),e.jsxs("div",{className:"flex-1 relative bg-zinc-200 rounded h-6 overflow-hidden",children:[e.jsx("div",{className:"h-full bg-lime-500 transition-all duration-500 ease-out",style:{width:`${t.usuarios/n*100}%`}}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-zinc-900 font-medium",children:t.usuarios})]})]},c))})})},T=s=>{const[o,n]=s.split("-").map(Number);return new Date(o,n-1).toLocaleString("es-ES",{month:"long",year:"numeric"})},G=({open:s,onClose:o,client_rate:n})=>{const t=n&&n.length>0,c=t?n.reduce((i,m)=>i+m.new_clients,0):0,l=t?c/n.length:0,d=t?n.reduce((i,m)=>m.new_clients>i.new_clients?m:i):null;return e.jsx(g,{open:s,onOpenChange:o,children:e.jsxs(j,{className:"w-full p-6 max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl rounded-3xl shadow-2xl bg-zinc-50 overflow-y-auto max-h-[80vh] ",children:[e.jsx(N,{className:"mb-2 pt-2",children:e.jsxs("div",{className:"flex items-start flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{className:"p-2 rounded-full bg-stone-100 hover:bg-stone-200 transition",onClick:o,children:e.jsx(w,{size:18,className:"text-zinc-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-zinc-700",children:"Registros Mensuales"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 rounded-xl text-white",children:e.jsx(D,{size:24})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg text-start font-semibold text-zinc-700",children:"Tasa de Nuevos Registros"}),e.jsx(v,{className:"text-start",children:"Visualiza la evolución de los registros mensuales para detectar tendencias de crecimiento o estacionalidad."})]})]})]})}),t?e.jsxs("main",{className:"flex flex-col space-y-6 px-1",children:[e.jsxs("section",{className:"bg-gray-100 p-4 rounded-xl text-sm text-zinc-700 mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Promedio mensual:"})," ",l.toFixed(2)," clientes"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mes con más registros:"})," ",T(d.month)," (",d.new_clients," ","clientes)"]})]}),e.jsxs("section",{className:"pb-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("h2",{className:"text-sm font-medium text-zinc-700",children:"Estadísticas mensuales"})}),e.jsx(_,{month_client_rate:n})]})]}):e.jsx("div",{className:"text-center text-zinc-500 py-12",children:e.jsx("p",{className:"text-sm",children:"No hay registros disponibles para mostrar."})})]})})},H=()=>{const{ocupationRate:s,barberInformation:o,totalPost:n,clientRate:t}=P(),[c,l]=r.useState(!1),d=()=>{l(i=>!i)};return e.jsxs("section",{className:"w-full py-3",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-zinc-800",children:"Panel de métricas"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Una vista general del rendimiento y actividad reciente."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsx(u,{icon:e.jsx(R,{size:24,className:"text-white"}),content:o==null?void 0:o.member,title:"Usuarios activos",description:"Total de usuarios registrados en la plataforma",callToAction:d,visibleButton:!0}),e.jsx(u,{icon:e.jsx(B,{size:24,className:"text-white"}),content:n,title:"Posts publicados",description:"Contenido creado para la comunidad",visibleButton:!1}),e.jsx(u,{icon:e.jsx(A,{size:24,className:"text-white"}),content:`${(s==null?void 0:s.ocuppancy_percentage)??0}%`,title:"Tasa de ocupación",description:"Porcentaje de turnos reservados",visibleButton:!1})]}),e.jsx(G,{open:c,onClose:d,client_rate:t})]})};export{H as default};
